project(w3m)
cmake_minimum_required(VERSION 3.0.0)
set(CMAKE_CXX_STANDARD 20)

set(W3M_PREFIX $ENV{HOME}/local)
   
add_executable(w3mbookmark
    src/w3mbookmark.cpp
    src/Str.cpp
    src/indep.cpp
    src/regex.cpp
    src/textlist.cpp
    src/parsetag.cpp
    src/myctype.cpp
    src/hash.cpp
    src/entity.cpp
    libwc/big5.cpp
    libwc/ces.cpp
    libwc/char_conv.cpp
    libwc/charset.cpp
    libwc/combining.cpp
    libwc/conv.cpp
    libwc/detect.cpp
    libwc/gb18030.cpp
    libwc/gbk.cpp
    libwc/hkscs.cpp
    libwc/hz.cpp
    libwc/iso2022.cpp
    libwc/jis.cpp
    libwc/johab.cpp
    libwc/priv.cpp
    libwc/putc.cpp
    libwc/search.cpp
    libwc/sjis.cpp
    libwc/status.cpp
    libwc/ucs.cpp
    libwc/uhc.cpp
    libwc/utf7.cpp
    libwc/utf8.cpp
    libwc/viet.cpp
    libwc/wtf.cpp
    )
target_include_directories(w3mbookmark
PUBLIC
    ${CMAKE_CURRENT_LIST_DIR}/libwc
    ${CMAKE_CURRENT_LIST_DIR}/src
    )   
target_compile_definitions(w3mbookmark
PUBLIC
    DUMMY
    HAVE_CONFIG_H
    AUXBIN_DIR=\"${W3M_PREFIX}/libexec/w3m\"
    CGIBIN_DIR=\"${W3M_PREFIX}/libexec/w3m/cgi-bin\"
    HELP_DIR=\"${W3M_PREFIX}/share/w3m\"
    ETC_DIR=\"${W3M_PREFIX}/etc\"
    CONF_DIR=\"${W3M_PREFIX}/etc/w3m\"
    RC_DIR=\"~/.w3m\"
    LOCALEDIR=\"${W3M_PREFIX}/share/locale\"
    USE_UNICODE
    )
target_link_libraries(w3mbookmark
PRIVATE
    gc
    )
        
add_executable(w3m
    src/main.cpp
    src/dispatcher.cpp
    src/commands.cpp
    src/tagtable.cpp
    src/entity.cpp
    src/anchor.cpp
    src/public.cpp
    src/display.cpp
    src/buffer.cpp
    src/tab.cpp
    src/file.cpp
    src/tagstack.cpp
    src/mimetypes.cpp
    src/line.cpp
    src/urlfile.cpp
    src/http_request.cpp
    # src/html_feed_environ.cpp
    src/backend.cpp
    src/cookie.cpp
    src/indep.cpp
    src/rc.cpp
    src/Str.cpp
    src/regex.cpp    
    src/textlist.cpp
    src/parsetag.cpp
    src/myctype.cpp
    src/hash.cpp
    src/etc.cpp
    src/search.cpp
    src/linein.cpp
    src/table.cpp
    src/local.cpp
    src/form.cpp
    src/map.cpp
    src/frame.cpp
    src/menu.cpp
    src/mailcap.cpp
    src/image.cpp
    src/symbol.cpp
    src/terms.cpp
    src/url.cpp
    src/ftp.cpp
    src/mimehead.cpp
    src/news.cpp
    src/mouse.cpp
    src/history.cpp
    src/version.cpp
    src/istream.cpp
    src/keybind.cpp
    src/parsetagx.cpp
    libwc/big5.cpp
    libwc/ces.cpp
    libwc/char_conv.cpp
    libwc/charset.cpp
    libwc/combining.cpp
    libwc/conv.cpp
    libwc/detect.cpp
    libwc/gb18030.cpp
    libwc/gbk.cpp
    libwc/hkscs.cpp
    libwc/hz.cpp
    libwc/iso2022.cpp
    libwc/jis.cpp
    libwc/johab.cpp
    libwc/priv.cpp
    libwc/putc.cpp
    libwc/search.cpp
    libwc/sjis.cpp
    libwc/status.cpp
    libwc/ucs.cpp
    libwc/uhc.cpp
    libwc/utf7.cpp
    libwc/utf8.cpp
    libwc/viet.cpp
    libwc/wtf.cpp
)
target_include_directories(w3m
PUBLIC
    ${CMAKE_CURRENT_LIST_DIR}/libwc
    ${CMAKE_CURRENT_LIST_DIR}/src
    )
target_compile_definitions(w3m
PUBLIC
    HAVE_CONFIG_H
    AUXBIN_DIR=\"${W3M_PREFIX}/libexec/w3m\"
    CGIBIN_DIR=\"${W3M_PREFIX}/libexec/w3m/cgi-bin\"
    HELP_DIR=\"${W3M_PREFIX}/share/w3m\"
    ETC_DIR=\"${W3M_PREFIX}/etc\"
    CONF_DIR=\"${W3M_PREFIX}/etc/w3m\"
    RC_DIR=\"~/.w3m\"
    LOCALEDIR=\"${W3M_PREFIX}/share/locale\"
    USE_UNICODE
    )
target_compile_options(w3m
PRIVATE
    -Werror=implicit-function-declaration
    -Werror=int-conversion
    -Werror=conversion-null
    )
target_link_libraries(w3m
PRIVATE
    gc
    m
    ncurses
    ssl
    crypto
    )
